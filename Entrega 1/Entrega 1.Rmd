---
title: Control Estadístico de Calidad
authors:
  - name: Michel Mendivenson Barragán Zabala
    department: Departamento de Estadística
    affiliation: Universidad Nacional de Colombia
    email: mbarraganz@unal.edu.co
  - name: Juan Sebastián Huertas Pirajan
    department: Departamento de Estadística
    affiliation: Universidad Nacional de Colombia
    email: juhuertasp@unal.edu.co
  - name: Diego Andres Paez Molina
    department: Departamento de Estadística
    affiliation: Universidad Nacional de Colombia
    email: dpaezm@unal.edu.co
output: 
  rticles::arxiv_article
header-includes:
  # La siguiente línea es para eliminar el enumerado de las secciones declaradas con ##
  - \setcounter{secnumdepth}{0}
  # - usepackage{float}
  # La siguiente línea es para eliminar el título del abstract
  - \renewenvironment{abstract}{}{}
  - \renewcommand{\theenumi}{\alph{enumi}}
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, fig.align = 'center',  out.width = "\\textwidth", out.extra = "keepaspectratio=false", fig.pos = 'H')

# Para habilitar la opción de cambiar el tamaño fuente del código
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

#### Ejercicio 1:

Sea $X \sim N(\mu, \sigma)$ una característica de calidad. Mediante simulaciones, establezca el comportamiento del *ARL* (en control y fuera de él) de las Cartas $R$ y $S$ para observaciones normales con límites $3\sigma$ y muestras de tamaño (a) $n = 3$ y (b) $n = 10$ ¿Qué regularidades observa?

> \small Para la implementación de la solución, se creará en R una función que nos permita simular cuantás veces querramos el momento en que un proceso da una alerta (bien sea verdadera o falsa) con argumentos que nos permitan modificar tanto el tamaño de muestra $n$ como los límites de la carta de control y su línea central para cada una de las cartas. Las funciones se definen como sigue:

```{r Funciones ejercicio 1,code = readLines('Funciones/RunLength.R'), size = 'footnotesize'}
```

> \small Tenga en cuenta que la salida de la función es un vector con los valores de los tiempos en que se detecto una señal dados los límites y la línea central correspondientes al proceso en control (El proceso en control se definió con $\mu = 0$, $\sigma = 1$ y además para cada uno se tomaron m = 1000 muestras de tiempos en que se generó una alerta). Los resultados para diferentes corrimientos se grafican a continuación:


```{r echo = FALSE,fig.height=4, fig.width = 12, fig.cap ='Comparación de ARL entre cartas R y S para n = 3, 10.'}
library(latex2exp)
resultadosP1 = read.csv('Resultados/Punto 1', row.names = 1)
colnames(resultadosP1) = gsub("k....", "k = ",colnames(resultadosP1))
colores = c('red', 'blue', 'red', 'blue'); corrimientos = as.numeric(gsub('k = ', '', colnames(resultadosP1)))
par(mfrow = c(1,2),mar = c(5.1,4.1,4.1,0))
plot(x = NULL, y = NULL, ylim = range(resultadosP1), xlim = range(corrimientos), main = 'Comparación ARL (n = 3)',
     ylab = 'Tiempo de alerta', xlab = TeX('Corrimiento ($k \\times \\sigma$)'),cex.lab = 0.8)
abline(v = seq(1, 3, by = 0.1), col = 'gray', lwd = 0.8, lty = 'dashed')
mtext(bquote(bold('El proceso estable N(0,1)')), side = 3, line = 0.5,adj = 0.5, cex = 0.8, col = 'darkgray')
for (i in 1:2){
  lines(x = corrimientos, y = resultadosP1[i,], col = colores[i], lwd = 1.5)
}

legend('topright',legend = c('Carta R', 'Carta S'), col = colores[1:2], lty = 'solid',bty = 'n', horiz = T)
par(mar = c(5.1,1.5,4.1,2.1))
plot(x = NULL, y = NULL, ylim = range(resultadosP1), xlim = range(corrimientos),
     main = 'Comparación ARL (n = 10)', yaxt = 'n', xlab = TeX('Corrimiento ($k \\times \\sigma$)'), cex.lab = 0.8)
abline(v = seq(1, 3, by = 0.1), col = 'gray', lwd = 0.8, lty = 'dashed')
mtext(bquote(bold('El proceso estable es N(0,1)')), side = 3, line = 0.5, adj = 0.5, cex = 0.8, col = 'darkgray')
for (i in 3:4){
  lines(x = corrimientos, y = resultadosP1[i,], col = colores[i], lwd = 1.5)
}
legend('topright',legend = c('Carta R', 'Carta S'), col = colores[1:2], lty = 'solid', bty = 'n', horiz = T)
```



> \small Se tomaron 81 corrimientos a intervalos regulares desde 1 hasta 3 por lo que una tabla no sería útil para analizar la información. Para $n = 3$ a la carta $R$ le toma, en promedio, más tiempo para producir falsas alarmas para un proceso estable mientras que para los corrimientos de $1.1 \times \sigma$ en adelante, la carta $R$ también tiende a tardar menos en dar una alarma verdadera. Por otro lado, la carta $S$ para un tamaño de subgrupos racionales de 10 tarda en promedio más tiempo que la carta $R$ para dar falsas alarmas y parece que hay una pequeña diferencia en cuanto a verdaderas alarmas a favor de la carta $S$. 

```{r echo = FALSE,fig.height=4, fig.width = 12, fig.cap ='Comparación de ARL para cada carta con n = 3, 10'}
par(mfrow = c(1,2), mar = c(5.1,4.1,4.1,0))
colores = c('red','red','blue', 'blue')
plot(x = NULL, y = NULL, ylim = range(resultadosP1), xlim = range(corrimientos),
     main = 'ARL Carta R', ylab = 'Tiempo de alerta',xlab = TeX('Corrimiento ($k \\times \\sigma$)'),cex.lab = 0.8)
abline(v = seq(1, 3, by = 0.1), col = 'gray', lwd = 0.8, lty = 'dashed')
mtext(bquote(bold('El proceso estable dsitribuye N(0,1)')), side = 3, line = 0.5,
      adj = 0.5, cex = 0.8, col = 'darkgray')
for (i in c(1,3)){
  lines(x = corrimientos, y = resultadosP1[i,], col = colores[i], lwd = 1.5)
}

legend('topright',legend = c('n = 3', 'n = 10'), col = c('red', 'blue'), lty = 'solid',bty = 'n', horiz = T)
par(mar = c(5.1,1.5,4.1,2.1))
plot(x = NULL, y = NULL, ylim = range(resultadosP1), xlim = range(corrimientos),main = 'ARL Carta S', yaxt = 'n',
     xlab = TeX('Corrimiento ($k \\times \\sigma$)'), cex.lab = 0.8)
abline(v = seq(1, 3, by = 0.1), col = 'gray', lwd = 0.8, lty = 'dashed')
mtext(bquote(bold('El proceso estable distribuye N(0,1)')), side = 3, line = 0.5, adj = 0.5, cex = 0.8, col = 'darkgray')
for (i in c(2,4)){
  lines(x = corrimientos, y = resultadosP1[i,], col = colores[i], lwd = 1.5)
}
legend('topright',legend = c('n = 3', 'n = 10'), col = c('red', 'blue'), lty = 'solid', bty = 'n', horiz = T)
```

> \small Además vemos que la carta $R$ tiene un comportamiento más estable respecto al cambio del tamaño de los subgrupos racionales mientras que S tiende a comportarse mejor a medida que este aumenta debido a, en promedio, presentar una menor frecuencia de falsas alarmas como mayor frecuencia de alarmas verdaderas.

#### Ejercicio 2:

Sea $X \sim N(\mu, \sigma)$ una característica de calidad. Se sabe que los valores objetivo de los parámetros del proceso son $\mu = \mu_0$ y $\sigma = \sigma_0$. Construir las curvas OC de la carta $S^2$ con límites de probabilidad. Interpretar los resultados

#### Ejercicio 3:

Sea $X \sim N(\mu_0, \sigma_0)$ una característica de calidad. Construya la carta $\bar{X}$ para el monitoreo de la media del proceso. Genere 10 muestras de tamaño $n$ provenientes de $X$, de tal modo que la media muestral de ninguna de ellas caiga fuera de los límites de control. A partir del undécimo momento de monitoreo se pide generar muestras del mismo tamaño $n$ provenientes de una distribución normal con media $\mu_1 = \mu_0 + k\sigma_0$ y $\sigma_1 = \sigma_0$ (con $k = 1,0$) hasta que la carta emita una señal por primera vez. Si se asume que el proceso caracterizado por $X$ es estable y que se desconoce el momento en el cual se produjo el incremento en el nivel medio, ¿en qué muestra ocurrió el cambio en la media del proceso más probablemente?

#### Ejercicio 4:

Sea $X \sim N(\mu_0, \sigma_0)$ una característica de calidad. Se pide:  
\begin{enumerate}
  \item Mediante simulaciones, establezca el comportamiento del ARL de la Carta $\bar{X}$ con límites tres sigma para observaciones normales.
  \item Genere 20 subgrupos racionales de tamaño $n = 3$ provenientes de $X$. Asúmase que el proceso es estable en cuanto a dispersión y con los subgrupos iniciales, construya la carta $\bar{X}$ como es habitual hasta verificar la estabilidad del proceso. Establezca el comportamiento del ARL para la carta que se obtiene del análisis de Fase I realizado.
  \item Repetir lo indicado en el literal (b) con 50 subgrupos racionales de tamaño $n = 3$. Comente los resultados.
\end{enumerate}

#### Ejercicio 5:

Calcular el ARL de la Carta $\bar{X}$ mediante cadenas de Markov. Diseñar la carta con límites de control ubicados a tres desviaciones estándar de la media y dividiendo la región de control estadístico en franjas de ancho igual a una desviación estándar.